"use client"

import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion"
import type { Vulnerability } from "@/types/scanner"

interface VulnerabilityDetailsProps {
  vulnerability: Vulnerability
}

export function VulnerabilityDetails({ vulnerability }: VulnerabilityDetailsProps) {
  return (
    <div className="p-4 bg-background" onClick={(e) => e.stopPropagation()}>
      <Accordion
        type="multiple"
        defaultValue={["location", "details", "impact", "remediation", "references"]}
        className="w-full"
      >
        <AccordionItem value="location">
          <AccordionTrigger>Location</AccordionTrigger>
          <AccordionContent>
            <div className="p-2 bg-muted/30 rounded text-sm font-mono overflow-x-auto">{vulnerability.location}</div>
          </AccordionContent>
        </AccordionItem>

        <AccordionItem value="details">
          <AccordionTrigger>Technical Details</AccordionTrigger>
          <AccordionContent>
            <div className="space-y-2">
              <div className="grid grid-cols-[100px_1fr] gap-2">
                <span className="text-sm font-medium">CWE ID:</span>
                <span className="text-sm">{vulnerability.cweid}</span>
              </div>
              {vulnerability.evidence && (
                <div className="grid grid-cols-[100px_1fr] gap-2">
                  <span className="text-sm font-medium">Evidence:</span>
                  <div className="p-2 bg-muted/30 rounded text-sm font-mono overflow-x-auto">
                    {vulnerability.evidence}
                  </div>
                </div>
              )}
            </div>
          </AccordionContent>
        </AccordionItem>

        <AccordionItem value="impact">
          <AccordionTrigger>Impact</AccordionTrigger>
          <AccordionContent>
            <p className="text-sm">{vulnerability.impact}</p>
          </AccordionContent>
        </AccordionItem>

        <AccordionItem value="remediation">
          <AccordionTrigger>How to Fix</AccordionTrigger>
          <AccordionContent>
            <div className="space-y-2">
              <p className="text-sm">{vulnerability.remedy}</p>
            </div>
          </AccordionContent>
        </AccordionItem>

        <AccordionItem value="references">
          <AccordionTrigger>References</AccordionTrigger>
          <AccordionContent>
            <ul className="list-disc pl-5 space-y-1 text-sm">
              {vulnerability.references.map((ref, idx) => (
                <li key={idx}>
                  <a
                    href={ref}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-primary hover:underline break-all"
                    onClick={(e) => e.stopPropagation()}
                  >
                    {ref}
                  </a>
                </li>
              ))}
            </ul>
          </AccordionContent>
        </AccordionItem>
      </Accordion>
    </div>
  )
}

